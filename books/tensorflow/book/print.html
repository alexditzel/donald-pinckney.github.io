<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Machine Learning with TensorFlow</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="An introductory look at implementing machine learning algorithms using TensorFlow in Python.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        
        <!-- MathJax -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

        <!-- Custom JS script -->
        

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="ch1-setup/intro.html"><strong>1.</strong> Introduction and Setup</a></li><li><ul class="section"><li><a href="ch1-setup/mac.html"><strong>1.1.</strong> macOS Setup</a></li><li><a href="ch1-setup/linux.html"><strong>1.2.</strong> Linux Setup</a></li><li><a href="ch1-setup/windows.html"><strong>1.3.</strong> Windows Setup</a></li></ul></li><li><a href="ch2-linreg/intro.html"><strong>2.</strong> Linear Regression</a></li><li><ul class="section"><li><a href="ch2-linreg/single-variable.html"><strong>2.1.</strong> Single Variable Regression</a></li><li><strong>2.2.</strong> Multi Variable Regression</li><li class="spacer"></li></ul></li><li><a href="http:/index.html">By Donald Pinckney</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title">Machine Learning with TensorFlow</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="print.html#introduction" id="introduction"><h1>Introduction</h1></a>
<p>Welcome to <em>Machine Learning with TensorFlow</em>, an easy to follow book / blog about understanding machine learning concepts and their implementation in <a href="https://www.python.org">Python</a> and <a href="https://www.tensorflow.org">TensorFlow</a>. My goal is to create an intuitive explanation of machine learning methods, paired with practical knowledge of implementation with TensorFlow. This book does assume some small working knowledge of programming, but Python specific syntax will be briefly introduced as needed.  In addition, some mathematics background will be useful, in particular linear algebra and calculus, but is not needed to follow the intuition and implementation. Resources to review relevant math concepts will be provided as required.</p>
<a class="header" href="print.html#what-exactly-is-machine-learning" id="what-exactly-is-machine-learning"><h2>What exactly is machine learning?</h2></a>
<p>Though the exact definition of machine learning is up for debate, we can roughly define machine learning as &quot;a field of computer science that gives computers the ability to learn without being explicitly programmed&quot; (Wikipedia). Traditionally, programming has been used to great effect to solve problems which have explicit steps. For example, consider the problem of determining if a number \(n\) is prime. We can easily determine if \(n\) is prime using fairly simple steps: check if \(n\) is divisible by \(2\), check if \(n\) is divisible by \(3\), \(\cdots\), check if \(n\) is divisible by \(n-1\). If \(n\) is divisible by any of these, then \(n\) is not prime, and otherwise it is prime. With traditional programming we then need to write these specific steps (an <strong>algorithm</strong>) in a programming language that our computer can interpret, and we have a working program which can classify numbers as prime much faster than a human ever could.</p>
<p>However, some tasks seem difficult or impossible to solve using specific steps like above. Rather than classifying prime numbers, let us instead try to classify images of dogs as either a Golden Retriever or Poodle.</p>
<table><thead><tr><th align="center">Golden Retriever                </th><th align="center">  Poodle</th></tr></thead><tbody>
<tr><td align="center"><img src="/books/tensorflow/book/ch1-setup/gold.jpg" alt="Golden Retriever Image" /> </td><td align="center"> <img src="/books/tensorflow/book/ch1-setup/poodle.jpg" alt="Poodle Image" /></td></tr>
</tbody></table>
<p>Most people would easily be able to differentiate the two breeds above, and accurately dogs of those breeds. But, can you explain <em>how</em> you came to this conclusion, in very specific steps? Perhaps, one might say that the hair of the Golden Retriever seems less curly, but then one would need to explain how to determine that the hair is less curly. There does not seem to exist a natural way to describe the curliness of hair in specific steps. Maybe, the shape of facial features such as nose shape are useful for determining dog breed, but it still seems nearly impossible to describe a precise algorithm that uses this data.</p>
<p>Qualitatively, humans do not seem to comprehend the breed of a dog by performing some precise algorithm, and this suggests that a computer program to solve this problem should not either. By using machine learning, we can use data to help the computer learn to recognize a dog breed, objects in general, human speech, etc., without explicitly programming it.</p>
<a class="header" href="print.html#so-what-is-tensorflow-and-why-do-we-need-it" id="so-what-is-tensorflow-and-why-do-we-need-it"><h2>So, what is TensorFlow, and why do we need it?</h2></a>
<p>Without diving into the details of various machine learning methods, I'll generally state that there <em>could</em> be a fairly significant amount of math involved. Not necessarily super difficult math, but some pretty cumbersome math. Roughly, TensorFlow takes care of the calculus grunt work for us: instead of spending a ton of time finding messy derivatives and many lines of code to compute them, TensorFlow lets us focus on the fairly elegant work of defining our machine learning methods, and the more important math necessary to obtain intuition.</p>
<p>So, without further ado, we can get started by installing Python, TensorFlow, and a few other useful tools. Just follow the appropriate directions for your operating system.</p>
<a class="header" href="print.html#macos-setup" id="macos-setup"><h1>macOS Setup</h1></a>
<p>Without a doubt, Python 3 is the future of Python, and thus we will use Python 3 with TensorFlow. While I summarize the instructions to install TensorFlow with Python 3 here, the <a href="https://www.tensorflow.org/install/install_mac">official TensorFlow documentation</a> should always provide up-to-date and comprehensive instructions for installation as well. If you run into any installation problems, please file a bug <a href="https://github.com/donald-pinckney/donald-pinckney.github.io/issues/new?labels=Installation%20problem,TensorFlow">here</a>.</p>
<a class="header" href="print.html#installing-python-3" id="installing-python-3"><h2>Installing Python 3</h2></a>
<p>macOS does not come installed with Python 3 (only Python 2.7), so we need to install it ourselves. The first step is to open terminal (Terminal.app on your Mac), and install the <a href="https://brew.sh">Homebrew</a> package manager for macOS, if you haven't already installed it before. Just paste the appropriate command into terminal, and follow Homebrew's installation prompts:</p>
<pre><code class="language-bash"># For bash, ksh, zsh, csh, and other shells:
/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
# For fish shell:
/usr/bin/ruby -e &quot;(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</code></pre>
<p>Now that Homebrew is installed, we need to install Python 3:</p>
<pre><code class="language-bash">brew install python3
</code></pre>
<p>You can test that <code>python3</code> installed correctly by running the command <code>python3</code>. You should see output similar to:</p>
<pre><code>~ $ python3
Python 3.6.3 (default, Nov 20 2017, 14:17:35) 
[GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.38)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;
</code></pre>
<p>The Python version should be 3.x.y instead of 2.x.y.</p>
<a class="header" href="print.html#installing-tensorflow-and-friends" id="installing-tensorflow-and-friends"><h2>Installing TensorFlow and friends</h2></a>
<p>Installing Python 3 (<code>python3</code>) also installs the Python 3 package manager (<code>pip3</code>). We can use <code>pip3</code> to install a Python utility called <code>virtualenv</code>. Virtualenv is an extremely easy and convenient way to install Python packages in a local and contained manner. The recommended way to install TensorFlow is by using <code>virtualenv</code>, since this ensures that the installation will be self-contained, and will not affect the rest of your system. So, first we need to install <code>virtualenv</code>:</p>
<pre><code class="language-bash">pip3 install --upgrade virtualenv
</code></pre>
<p>Now, create a new virtualenv:</p>
<pre><code class="language-bash"># In this command, ~/tensorflow is the destination directory where the virtualenv will be created. 
# You can choose a different location if you prefer, but the rest of the installation tutorial will assume ~/tensorflow
virtualenv --system-site-packages -p python3 ~/tensorflow
</code></pre>
<p>Then, we need to activate the virtualenv so we can install things inside it:</p>
<pre><code class="language-bash">source ~/tensorflow/bin/activate # If using bash, sh, ksh, zsh
source ~/tensorflow/bin/activate.csh # If using csh or tcsh
source ~/tensorflow/bin/activate.fish # If using fish
</code></pre>
<p>After activating the virtualenv, your command prompt should change to look like: <code>(tensorflow)$</code>. At this point, we are finally ready to install TensorFlow:</p>
<pre><code class="language-bash">pip3 install --upgrade tensorflow 
</code></pre>
<p>In addition, we also install a few other Python packages that are useful for machine learning:</p>
<pre><code class="language-bash">pip3 install --upgrade numpy # Used for linear algebra. Essential for using TensorFlow 
pip3 install --upgrade matplotlib # Used for plotting data, which is very useful for machine learning
pip3 install --upgrade pandas # Used for loading data sets
</code></pre>
<p>Once everything is installed, you can exit the virtualenv using the command <code>deactivate</code>.</p>
<a class="header" href="print.html#testing-the-installation" id="testing-the-installation"><h2>Testing the installation</h2></a>
<p>Let's just quickly test the installation, to verify everything is installed and ready to go! If it isn't currently activated, activate your virtualenv with the appropriate activate command from above. Then, run the <code>python</code> command, and type the following code into Python:</p>
<pre><code class="language-python">import tensorflow as tf
import numpy as np
import pandas
import matplotlib.pyplot as plt
hello = tf.constant('Hello, TensorFlow!')
sess = tf.Session()
print(sess.run(hello))
</code></pre>
<p>If everything is installed correctly, you should see the output:</p>
<pre><code>Hello, TensorFlow!
</code></pre>
<p>If the above test produces errors, please see this list of <a href="https://www.tensorflow.org/install/install_mac#common_installation_problems">common TensorFlow installation problems</a> or Google it, and file a bug <a href="https://github.com/donald-pinckney/donald-pinckney.github.io/issues/new?labels=Installation%20problem,Duplicate&amp;title=Installation%20error%20on%20macOS">here</a>.</p>
<a class="header" href="print.html#optional-installing-an-ide" id="optional-installing-an-ide"><h2>Optional: Installing an IDE</h2></a>
<p>At this point, everything we need for writing TensorFlow code is installed. We can write our Python code in a text editor of our choice, and run it using <code>python</code> from terminal. In the future I won't assume use of an IDE specifically, but rather assume that you can create new Python files and run them, either from terminal or an IDE. However, some people may prefer using an IDE, which can reduce the time spent in Terminal, and help provide better syntax and semantic checking of Python code. Personally, I use and recommend PyCharm, which you can download for free <a href="https://www.jetbrains.com/pycharm/download/#section=mac">here</a>. I won't provide specific installation instructions, but I found it very easy to install and configure to use the <code>~/tensorflow</code> virtualenv.</p>
<a class="header" href="print.html#linux-ubuntu-setup" id="linux-ubuntu-setup"><h1>Linux (Ubuntu) Setup</h1></a>
<p>Without a doubt, Python 3 is the future of Python, and thus we will use Python 3 with TensorFlow. While I summarize the instructions to install TensorFlow with Python 3 here, the <a href="https://www.tensorflow.org/install/install_linux">official TensorFlow documentation</a> should always provide up-to-date and comprehensive instructions for installation as well. If you run into any installation problems, please file a bug <a href="https://github.com/donald-pinckney/donald-pinckney.github.io/issues/new?labels=Installation%20problem,TensorFlow">here</a>. Note that Ubuntu is the only officially supported Linux distribution for TensorFlow, but with a bit of effort TensorFlow can likely be installed on other distributions as well.</p>
<a class="header" href="print.html#optional-install-gpu-support" id="optional-install-gpu-support"><h2>Optional: Install GPU Support</h2></a>
<p>On Linux TensorFlow has the ability to run your machine learning models on a GPU, which can make computation significantly faster. However, the speed difference is negligible until we start building extremely large models with massive amounts of data. So if you have a supported GPU, you could choose to install GPU support now, or just wait until later. To see if your GPU is supported and instructions for installing GPU support, see <a href="https://www.tensorflow.org/install/install_linux#nvidia_requirements_to_run_tensorflow_with_gpu_support">here</a>.</p>
<a class="header" href="print.html#installing-pip-and-virtualenv" id="installing-pip-and-virtualenv"><h2>Installing Pip and Virtualenv</h2></a>
<p>First, we need to install <code>pip</code>, and <code>virtualenv</code>. This should be easy using <code>apt-get</code>:</p>
<pre><code class="language-bash">sudo apt-get install python3-pip python3-dev python-virtualenv
</code></pre>
<a class="header" href="print.html#installing-tensorflow-and-friends-1" id="installing-tensorflow-and-friends-1"><h2>Installing TensorFlow and friends</h2></a>
<p>Virtualenv is an extremely easy and convenient way to install Python packages in a local and contained manner. The recommended way to install TensorFlow is by using <code>virtualenv</code>, since this ensures that the installation will be self-contained, and will not affect the rest of your system. Now, we need to create a new virtualenv:</p>
<pre><code class="language-bash"># In this command, ~/tensorflow is the destination directory where the virtualenv will be created. 
# You can choose a different location if you prefer, but the rest of the installation tutorial will assume ~/tensorflow
virtualenv --system-site-packages -p python3 ~/tensorflow
</code></pre>
<p>Then, we need to activate the virtualenv so we can install things inside it:</p>
<pre><code class="language-bash">source ~/tensorflow/bin/activate # If using bash, sh, ksh, zsh
source ~/tensorflow/bin/activate.csh # If using csh or tcsh
source ~/tensorflow/bin/activate.fish # If using fish
</code></pre>
<p>After activating the virtualenv, your command prompt should change to look like: <code>(tensorflow)$</code>. At this point, we are finally ready to install TensorFlow:</p>
<pre><code class="language-bash">pip3 install --upgrade tensorflow # If installing WITHOUT GPU support
pip3 install --upgrade tensorflow-gpu # If installing WITH GPU support
</code></pre>
<p>In addition, we also install a few other Python packages that are useful for machine learning:</p>
<pre><code class="language-bash">pip3 install --upgrade numpy # Used for linear algebra. Essential for using TensorFlow 
pip3 install --upgrade matplotlib # Used for plotting data, which is very useful for machine learning
pip3 install --upgrade pandas # Used for loading data sets
</code></pre>
<p>Once everything is installed, you can exit the virtualenv using the command <code>deactivate</code>.</p>
<a class="header" href="print.html#testing-the-installation-1" id="testing-the-installation-1"><h2>Testing the installation</h2></a>
<p>Let's just quickly test the installation, to verify everything is installed and ready to go! If it isn't currently activated, activate your virtualenv with the appropriate activate command from above. Then, run the <code>python</code> command, and type the following code into Python:</p>
<pre><code class="language-python">import tensorflow as tf
import numpy as np
import pandas
import matplotlib.pyplot as plt
hello = tf.constant('Hello, TensorFlow!')
sess = tf.Session()
print(sess.run(hello))
</code></pre>
<p>If everything is installed correctly, you should see the output:</p>
<pre><code>Hello, TensorFlow!
</code></pre>
<p>If the above test produces errors, please see this list of <a href="https://www.tensorflow.org/install/install_linux#common_installation_problems">common TensorFlow installation problems</a> or Google it, and file a bug <a href="https://github.com/donald-pinckney/donald-pinckney.github.io/issues/new?labels=Installation%20problem,Duplicate&amp;title=Installation%20error%20on%20Linux">here</a>.</p>
<a class="header" href="print.html#optional-installing-an-ide-1" id="optional-installing-an-ide-1"><h2>Optional: Installing an IDE</h2></a>
<p>At this point, everything we need for writing TensorFlow code is installed. We can write our Python code in a text editor of our choice, and run it using <code>python</code> from terminal. In the future I won't assume use of an IDE specifically, but rather assume that you can create new Python files and run them, either from terminal or an IDE. However, some people may prefer using an IDE, which can reduce the time spent in terminal, and help provide better syntax and semantic checking of Python code. Personally, I use and recommend PyCharm, which you can download for free <a href="https://www.jetbrains.com/pycharm/download/#section=linux">here</a>. I won't provide specific installation instructions, but I found it very easy to install and configure to use the <code>~/tensorflow</code> virtualenv.</p>
<a class="header" href="print.html#windows-setup" id="windows-setup"><h1>Windows Setup</h1></a>
<p>To be blunt, I only use macOS and Linux, and I have no experience installing TensorFlow or even Python on Windows. Instead, I will simply direct you to the <a href="https://www.tensorflow.org/install/install_windows">official documentation for TensorFlow on Windows</a>.</p>
<p>When installing Python, please ensure that you use Python 3, rather than Python 2. Also, install the Python packages <a href="http://www.numpy.org">NumPy</a>, <a href="http://pandas.pydata.org">Pandas</a> and <a href="https://matplotlib.org">matplotlib</a> in addition to TensorFlow.</p>
<a class="header" href="print.html#optional-installing-an-ide-2" id="optional-installing-an-ide-2"><h2>Optional: Installing an IDE</h2></a>
<p>At this point, everything we need for writing TensorFlow code in installed. We can write our Python code in a text editor of our choice, and run it using <code>python</code> from terminal. In the future I won't assume use of an IDE specifically, but rather assume that you can create new Python files and run them, either from terminal or an IDE. However, some people may prefer using an IDE, which can reduce the time spent in terminal, and help provide better syntax and semantic checking of Python code. Personally, I use and recommend PyCharm, which you can download for free <a href="https://www.jetbrains.com/pycharm/download/#section=windows">here</a>. I won't provide specific installation instructions, but I found it very easy to install and configure.</p>
<a class="header" href="print.html#linear-regression" id="linear-regression"><h1>Linear Regression</h1></a>
<p>Roughly, there are two categories of machine learning:</p>
<ol>
<li>In <strong>supervised learning</strong> one already has access to a data set of example inputs and desired outputs, and teaches the computer to produce the desired outputs given the example inputs.</li>
<li>In <strong>unsupervised learning</strong> one only has access to a data set: there is not necessarily any notion of &quot;input&quot; and &quot;output&quot;. The goal is to teach the computer to autonomously discover underlying patterns in the data set.</li>
</ol>
<p>For example, if we have a data set containing students' GPAs and SAT scores, we could attempt to train a supervised machine learning model to predict SAT scores given GPAs. Here, GPA would be the input, and SAT score would be the desired output. On the other hand, if we only have access to students' GPAs, then we could try to use unsupervised machine learning models to find patterns in the GPAs: perhaps there exist &quot;clusters&quot; in the data of similarly performing students.</p>
<p>Unsupervised machine learning will be touched on later, but for now we focus on supervised machine learning: in general it is easier, and the objective is clearer.  Specifically, there are two main types of supervised learning:</p>
<ol>
<li><strong>Regression</strong> aims to predict a continuous output, given the inputs.</li>
<li><strong>Classification</strong> aims to predict a classification, given the inputs.</li>
</ol>
<p>The GPA and SAT score example from above is an example of regression, since we are trying to predict the continuous output variable of SAT scores. We aren't trying to classify students based on GPAs, we just want to estimate what their SAT score will be. On the other hand, suppose we also have data about UC Davis college admissions: we could then try to predict whether or not a student will be accepted based on their GPA. This would be an example of classification, since the output of the prediction is not continuous, it is a classification (accepted or rejected).</p>
<p>In this chapter we look at regression only, and specifically the simplest form: linear regression. We start with the most basic form of linear regression (single variable linear regression), and then move on to consider variants of linear regression. Using these variants we can obtain models that are both fairly simple and powerful.</p>
<a class="header" href="print.html#single-variable-regression" id="single-variable-regression"><h1>Single Variable Regression</h1></a>
<a class="header" href="print.html#motivation" id="motivation"><h2>Motivation</h2></a>
<p>Single variable linear regression is one of the fundamental tools for any interpretation of data. Using linear regression, we can predict continuous variable outcomes given some data, if the data has a roughly linear shape, i.e. it generally has the shape a line. For example, consider the plot below of 2015 US homicide deaths per age<sup class="footnote-reference"><a href="print.html#fn1">1</a></sup>, and the line of best fit next to it.</p>
<table><thead><tr><th align="center">Original data              </th><th align="center">  Result of single variable linear regression</th></tr></thead><tbody>
<tr><td align="center"><img src="/books/tensorflow/book/ch2-linreg/homicide.png" alt="Homicide Plot" /> </td><td align="center"> <img src="/books/tensorflow/book/ch2-linreg/homicide_fit.png" alt="Homicide Regression Plot" /></td></tr>
</tbody></table>
<p>Visually, it appears that this data is approximated pretty well by a &quot;line of best fit&quot;. Single variable linear regression is precisely the tool to find this line. The line of best fit can then be used to guess how many homicide deaths there would be for ages we don't have data on. By the end of this tutorial you can run linear regression on this homicide data, and in fact solve any single variable regression problem.</p>
<a class="header" href="print.html#theory" id="theory"><h2>Theory</h2></a>
<p>Since we don't have any theory yet to understand linear regression, first we need to develop the theory necessary to program it.</p>
<a class="header" href="print.html#data-set-format" id="data-set-format"><h3>Data set format</h3></a>
<p>For regression problems, the goal is to predict a continuous variable output, given some input variables (usually also continuous). For single variable regression, we only have one input variable, called \(x\), and our <em>desired</em> output \(y\). Our data set \(D\) then consists of many examples of \(x\) and \(y\), so:
\[
D = \{ (x_1, y_1), (x_2, y_2), \cdots, (x_m, y_m) \}
\]
where \(m\) is the number of examples in the data set. For a concrete example, the homicide data set plotted above looks like:
\[
D = \{ (21, 652), (22, 633), \cdots, (50, 197) \}
\]
We will write code to load data sets from files later.</p>
<a class="header" href="print.html#model-concept" id="model-concept"><h3>Model concept</h3></a>
<p>So, how can we mathematically model single linear regression? Since the goal is to find the perfect line, let's start by defining the <strong>model</strong> (the mathematical description of how predictions will be created) as a line:
\[
y'(x, a, b) = ax + b
\]
where \(x\) is an input, \(a, b\) are constants, and \(y'\) is the prediction for the input \(x\). Note that although this is an equation for a line with \(x\) as the variable, the values of \(a\) and \(b\) determine what specific line it is. To find the best line, we just need to find the best values for \(a\) (the slope) and \(b\) (the y-intercept). For example, the line of best fit for the homicide data above has a slope of about \(a \approx -17.69\) and a y-intercept of \(b \approx 1000\). How we find the magic best values for \(a\) and \(b\) we don't know yet, but once we find them, prediction is easy, since we just use the formula above.</p>
<p>How then, how do we find the correct values of \(a\) and \(b\)? First, we need a way to define what the &quot;best line&quot; is exactly. To do so, we define a <strong>loss function</strong> (also called a cost function), which measures how bad a particular choice of \(a\) and \(b\) are. Values of \(a\) and \(b\) that seem poor (a line that does not fit the data set) should result in a large value of the loss function, whereas good values of \(a\) and \(b\) (a line that fits the data set well) should result in small values of the loss function. In other words, the loss function should measure how far the predicted line is from each of the data points, and add this value up for all data points. We can write this as:
\[
L(a, b) = \sum_{i=1}^m (y'(x_i, a, b) - y_i)^2
\]
Recall that there are \(m\) examples in the data set, \(x_i\) is the i'th input, and \(y_i\) is the i'th desired output. So, \((y'(x_i, a, b) - y_i)^2\) measures how far the i'th prediction is from the i'th desired output. For example, if the prediction \(y'\) is 7, and the correct output \(y\) is 10, then we would get \((7 - 10)^2 = 9.\) Note that squaring it is important so that it is always positive.  Finally, we just add up all of these individual losses.</p>
<blockquote>
<p>Note: The choice to square \(y'(x_i, a, b) - y_i\) is somewhat arbitrary. Though we need to make it positive, we could achieve this in many ways, such as taking the absolute value. In sense, the choice of models and loss functions is the creative aspect of machine learning, and often a certain loss function is chosen simply because it produces satisfying results. Manipulating the loss function to achieve more satisfying results will be done in section 2.3.</p>
</blockquote>
<a class="header" href="print.html#optimizing-the-model" id="optimizing-the-model"><h3>Optimizing the model</h3></a>
<p>At this point, we have fully defined both our model:
\[
y'(x, a, b) = ax + b
\]
and our loss function, into which we can substitute the model:
\[
L(a, b) = \sum_{i=1}^m (y'(x_i, a, b) - y_i)^2 = \sum_{i=1}^m (a x_i + b - y_i)^2
\]
We crafted \(L(a, b)\) so that it is smallest exactly when \(a\) and \(b\) produce the line of best fit. Therefore, our goal is to find the values of \(a\) and \(b\) that minimize the function \(L(a, b)\). But what does \(L\) really look like? Well, it is essentially a 3D parabola which looks like:</p>
<p><img src="/books/tensorflow/book/ch2-linreg/minimum.png" alt="Minimum Plot" /></p>
<p>The red dot marked on the plot of \(L\) shows where the desired minimum is. We need an algorithm to find this minimum. From calculus, we know that at the minimum \(L\) must be entirely flat, that is the derivatives are both \(0\):
\[
\frac{\partial L}{\partial a} = \sum_{i=1}^m 2(ax_i + b - y_i)x_i = 0 \\
\frac{\partial L}{\partial b} = \sum_{i=1}^m 2(ax_i + b - y_i) = 0 \
\]
If you need to review this aspect of calculus, I would recommend <a href="https://www.khanacademy.org/math/differential-calculus/analyzing-func-with-calc-dc">Khan Academy videos</a>. Now, for this problem it is possible to solve for \(a\) and \(b\) using the equations above, like we would in a typical calculus course. But for more advanced machine learning this is impossible, so instead we will learn to use an algorithm called <em><a href="https://en.wikipedia.org/wiki/Gradient_descent">gradient descent</a></em> to find the minimum. The idea is intuitive: place a ball at an arbitrary location on the surface of \(L\), and it will naturally roll downhill towards the flat valley of \(L\) and thus find the minimum. We know the direction of &quot;downhill&quot; at any location since we know the derivatives of \(L\): the derivatives are the direction of greatest upward slope, so the opposite (negative) derivatives are the most downhill direction. Therefore, if the ball is currently at location \((a, b)\), we can simulate it's motion by moving it to location \((a', b')\) like so:
\[
a' = a - \alpha \frac{\partial L}{\partial a} \\
b' = b - \alpha \frac{\partial L}{\partial b} \\
\]
where \(\alpha\) is a constant called the <strong>learning rate</strong>, which we will talk about more later. If we repeat this process then the ball will continue to roll downhill into the minimum. An animation of this process looks like:</p>
<video autoplay loop muted>
<source type="video/mp4" src="/books/tensorflow/book/ch2-linreg/line_fast.mp4">
</video>
<p>When we run the gradient descent algorithm for long enough, then it will find the optimal location for \((a, b)\). Once we have the optimal values of \(a\) and \(b\), then that's it, we can just use them to predict a rate of homicide deaths given any age, using the model:
\[
y'(x) = ax + b
\]</p>
<a class="header" href="print.html#implementation" id="implementation"><h2>Implementation</h2></a>
<p>Let's quickly review what we did when defining the theory of linear regression:</p>
<ol>
<li>Describe the data set</li>
<li>Define the model</li>
<li>Define the loss function</li>
<li>Run the gradient descent optimization algorithm</li>
<li>Use the optimal model to make predictions</li>
<li>Profit!</li>
</ol>
<p>When coding this we will follow the exact same steps. So, create a new file <code>single_var_reg.py</code> in the text editor or IDE of your choice (or experiment in the Python REPL), and download the <a href="/books/tensorflow/book/ch2-linreg/homicide.csv">homicide death rate data set</a> into the same directory.</p>
<a class="header" href="print.html#importing-the-data" id="importing-the-data"><h3>Importing the data</h3></a>
<p>First, we need to import all the modules we will need:</p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf
import pandas as pd
import matplotlib.pyplot as plt
</code></pre>
<p>We use pandas to easily load the CSV homicide data:</p>
<pre><code class="language-python">D = pd.read_csv(&quot;homicide.csv&quot;).values
x_data = 
</code></pre>
<div class="footnote-definition" id="fn1"><sup class="footnote-definition-label">1</sup>
<p>Centers for Disease Control and Prevention, National Center for Health Statistics. Underlying Cause of Death 1999-2015 on CDC WONDER Online Database, released December, 2016. Data are from the Multiple Cause of Death Files, 1999-2015, as compiled from data provided by the 57 vital statistics jurisdictions through the Vital Statistics Cooperative Program. Accessed at http://wonder.cdc.gov/ucd-icd10.html on Nov 22, 2017 2:18:46 PM.</p>
</div>
<a class="header" href="print.html#by-donald-pinckney" id="by-donald-pinckney"><h1>By Donald Pinckney</h1></a>

                </div>

                <!-- Mobile navigation buttons -->
                

                

            </div>

            

            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        
        <script>
            $(document).ready(function() {
                window.print();
            })
        </script>
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
